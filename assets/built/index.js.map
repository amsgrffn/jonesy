{"version":3,"file":"index.js","sources":["../js/index.js"],"sourcesContent":["/**\n * Main JavaScript for Ghost theme\n * Handles:\n * - Article navigation (J/K keys)\n * - Infinite scroll and post filtering\n * - Social sharing functionality\n * - Responsive sidenotes\n * - Accessibility features\n *\n * Dependencies:\n * - Isotope (for grid layout)\n * - CSS: ../css/index.css\n */\n\n////////// Import CSS //////////\nimport '../css/index.css';\n\n// Enhanced Input Validation\nconst InputValidator = {\n    patterns: {\n        email: /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$/,\n        url: /^https?:\\/\\/[a-zA-Z0-9-_.]+\\.[a-zA-Z]{2,}(?:\\/[^\\s]*)?$/,\n        text: /^[\\p{L}\\p{N}\\s\\-_.,!?]{1,500}$/u,\n        numeric: /^\\d{1,10}$/\n    },\n\n    validate(value, type) {\n        if (!value || !type || !this.patterns[type]) {\n            return false;\n        }\n        const sanitized = this.sanitize(value);\n        return this.patterns[type].test(sanitized);\n    },\n\n    sanitize(value) {\n        return String(value)\n            .trim()\n            .replace(/[^\\p{L}\\p{N}\\s\\-_.,!?@]/gu, '');\n    }\n};\n\nconst RateLimiter = {\n    getKey(action) {\n        // Create a key based on the current minute\n        const now = Math.floor(Date.now() / 1000 / 60);\n        return `rateLimit_${action}_${now}`;\n    },\n\n    increment(action, limit) {\n        const key = this.getKey(action);\n        // Get current count or start at 0\n        let count = parseInt(sessionStorage.getItem(key) || '0');\n        count++;\n        // Store updated count\n        sessionStorage.setItem(key, count.toString());\n        return count <= limit;\n    },\n\n    checkLimit(action, limit = 60, windowMs = 60000) {\n        // Clean up old entries first\n        this.cleanup();\n        return this.increment(action, limit);\n    },\n\n    cleanup() {\n        const now = Math.floor(Date.now() / 1000 / 60);\n        // Iterate through all storage items\n        for (let i = 0; i < sessionStorage.length; i++) {\n            const key = sessionStorage.key(i);\n            if (key && key.startsWith('rateLimit_')) {\n                const timeKey = parseInt(key.split('_')[2]);\n                // Remove entries older than 5 minutes\n                if (now - timeKey > 5) {\n                    sessionStorage.removeItem(key);\n                }\n            }\n        }\n    }\n};\n\n////////// Enhanced Security Utilities //////////\nconst SECURITY = {\n    urlPatterns: {\n        dangerous: /javascript:|data:|vbscript:|file:|blob:|ftp:|ws:|wss:/i,\n        symbols: /[<>'\"`{}()\\[\\]]/\n    },\n    inputPatterns: {\n        text: /^[a-zA-Z0-9\\s\\-_.,!?]*$/,\n        email: /^[^@\\s]+@[^@\\s]+\\.[^@\\s]+$/,\n        numeric: /^\\d+$/\n    }\n};\n\n////////// Accessibility Constants //////////\nconst KEYS = {\n    TAB: 'Tab',\n    ENTER: 'Enter',\n    ESCAPE: 'Escape',\n    SPACE: ' ',\n    UP: 'ArrowUp',\n    DOWN: 'ArrowDown',\n    LEFT: 'ArrowLeft',\n    RIGHT: 'ArrowRight',\n    HOME: 'Home',\n    END: 'End',\n    J: 'j',  // Next article\n    K: 'k',  // Previous article\n    N: 'n',  // Next article (alternative)\n    P: 'p'  // Previous article (alternative)\n};\n\nconst ARIA_ATTRS = {\n    EXPANDED: 'aria-expanded',\n    HIDDEN: 'aria-hidden',\n    CONTROLS: 'aria-controls',\n    CHECKED: 'aria-checked',\n    SELECTED: 'aria-selected',\n    LABEL: 'aria-label',\n    LABELLEDBY: 'aria-labelledby',\n    LISTBOX: 'listbox',\n    OPTION: 'option'\n};\n\n////////// Sidenotes Configuration //////////\nconst SIDENOTES_CONFIG = {\n    articleSelector: 'article',\n    contentSelector: '.article-content',\n    footerSelector: 'footer',\n    notesWrapperClass: 'sidenotes-wrapper',\n    mobileBreakpoint: 1040,\n    mobileNotesClass: 'mobile-sidenotes'\n};\n\n////////// Infinite Carousel Configuration //////////\nconst CAROUSEL_CONFIG = {\n    trackClass: 'carousel-track',\n    cardClass: 'article-card'\n};\n\n////////// Post Filter Configuration //////////\nconst FILTER_CONFIG = {\n    containerId: 'post-type-filter',\n    types: [\n        { id: 'all', label: 'All Posts' },\n        { id: 'article', label: 'Articles' },\n        { id: 'bookmarks', label: 'Bookmarks' },\n        { id: 'notes', label: 'Notes' },\n        { id: 'quotes', label: 'Quotes' }\n    ]\n};\n\n////////// Related Articles Panel Configuration //////////\nconst RELATED_PANEL_CONFIG = {\n    triggerButtonClass: 'related-trigger',\n    panelClass: 'related-panel',\n    overlayClass: 'panel-overlay',\n    closeBtnClass: 'close-panel',\n    activeClass: 'active',\n    panelOpenClass: 'panel-open',\n    maxOpenAttempts: 10,\n    timeWindowMs: 60000, // 1 minute\n    focusableSelectors: [\n        'button:not([disabled])',\n        '[href]:not([href*=\"javascript:\"])',  // Prevent javascript: URLs\n        'input:not([disabled])',\n        'select:not([disabled])',\n        'textarea:not([disabled])',\n        '[tabindex]:not([tabindex=\"-1\"])'\n    ].join(',')\n};\n\n////////// Testimonials Configuration //////////\nconst TESTIMONIALS_CONFIG = {\n    updateInterval: 7000,\n    fadeTransitionMs: 500,\n    testimonials: [\n        {\n            quote: \"Newsletters suck. This one sucks the most.\",\n            author: \"John Bender\",\n            avatar: \"media/avatars/bender.webp\",\n            link: \"https://thebreakfastclub.fandom.com/wiki/John_Bender\"\n        },\n        {\n            quote: \"I ain't got time to read this crap\",\n            author: \"Blain Cooper\",\n            avatar: \"media/avatars/blain.webp\",\n            link: \"https://avp.fandom.com/wiki/Blain_Cooper\"\n        },\n        {\n            quote: \"My life's been one long, glorious ‘sitting on beach earning twenty percent' vibe-fest since becoming a member of You Can't Be Serious.\",\n            author: \"Hans Gruber\",\n            avatar: \"media/avatars/hans.webp\",\n            link: \"https://en.wikipedia.org/wiki/Hans_Gruber\"\n        },\n        {\n            quote: \"I pity the fool who don't support You Can't Be Serious.\",\n            author: \"Clubber Lang\",\n            avatar: \"media/avatars/clubber.webp\",\n            link: \"https://en.wikipedia.org/wiki/Clubber_Lang\"\n        },\n        {\n            quote: \"This site was, is, and will always be nada\",\n            author: \"Steff McKee\",\n            avatar: \"media/avatars/steff.webp\",\n            link: \"https://en.wikipedia.org/wiki/Pretty_in_Pink\"\n        },\n        {\n            quote: \"You're God Damn right I read You Can't Be Serious.\",\n            author: \"Colonel Nathan R. Jessup\",\n            avatar: \"media/avatars/jessup.webp\",\n            link: \"https://villains.fandom.com/wiki/Colonel_Nathan_R._Jessup\"\n        },\n        {\n            quote: \"These people are a stain on the internet. It's best to go about your daily routine and forget they exist.\",\n            author: \"Mildred Ratched\",\n            avatar: \"media/avatars/mildred.webp\",\n            link: \"https://en.wikipedia.org/wiki/Nurse_Ratched\"\n        },\n        {\n            quote: \"So this newsletter right. It’s 90% bullshit, but it’s entertaining. That’s why I read it because it entertains me.\",\n            author: \"Alonzo Harris\",\n            avatar: \"media/avatars/alonzo.webp\",\n            link: \"https://villains.fandom.com/wiki/Alonzo_Harris\"\n        },\n        {\n            quote: \"All I need are some tasty waves, a cool buzz, You Can't Be Serious, and I'm fine.\",\n            author: \"Jeff Spicoli\",\n            avatar: \"media/avatars/spicoli.webp\",\n            link: \"https://www.theringer.com/2020/08/26/movies/spicoli-fast-times-ridgemont-high-teen-movie\"\n        },\n        {\n            quote: \"Listen, I don't bother nobody and nobody bothers me but these brothers are pretty cool. They see \\u2018em you know.\",\n            author: \"Frank\",\n            avatar: \"media/avatars/frank.webp\",\n            link: \"https://en.wikipedia.org/wiki/They_Live\"\n        },\n        {\n            quote: \"You Can't Be Serious? Those dudes talk shit, saying they'll make it rain good times and all that. The only rain you'll be catching from them is a light drizzle of dickwater.\",\n            author: \"Reggie Hammond\",\n            avatar: \"media/avatars/reggie.webp\",\n            link: \"https://www.cracked.com/article_36231_48-hrs-at-40-how-eddie-murphys-first-movie-birthed-the-buddy-cop-comedy.html\"\n        },\n        {\n            quote: \"My God, it's full of bullshit.\",\n            author: \"David Bowman\",\n            avatar: \"media/avatars/bowman.webp\",\n            link: \"https://2001.fandom.com/wiki/David_Bowman\"\n        },\n        {\n            quote: \"I'd rather have my eyelids stapled shut than read this trash.\",\n            author: \"Regina George\",\n            avatar: \"media/avatars/regina.webp\",\n            link: \"https://en.wikipedia.org/wiki/Regina_George_(Mean_Girls)\"\n        },\n        {\n            quote: \"Hey man, I don't wanna rain on their parade, but these guys won't last seventeen days. Easy. Game over for them man.\",\n            author: \"Private First Class William L. Hudson\",\n            avatar: \"media/avatars/hudson.webp\",\n            link: \"https://en.wikipedia.org/wiki/Hudson_%28Aliens%29\"\n        },\n        {\n            quote: \"This quitting thing, it's a hard habit to break once you start, but one thing I'll never quit is this website.\",\n            author: \"Morris Buttermaker\",\n            avatar: \"media/avatars/buttermaker.webp\",\n            link: \"https://en.wikipedia.org/wiki/The_Bad_News_Bears\"\n        },\n        {\n            quote: \"Blogs are teeming petri dishes of malignant mediocrity. Written by mental maggots consuming their own predigested pablum. You Can't Be Serious is the excretion.\",\n            author: \"Lydia Tár\",\n            avatar: \"media/avatars/tar.webp\",\n            link: \"https://en.wikipedia.org/wiki/T%C3%A1r\"\n        }\n    ]\n};\n\nconst WEATHER_ICONS = {\n    sunny: `\n        <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" class=\"weather-icon inline-icon\" fill=\"none\" stroke=\"currentColor\">\n            <path d=\"M12 17a5 5 0 100-10 5 5 0 000 10zM12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42\"\n                  stroke-width=\"2\" stroke-linecap=\"round\"/>\n        </svg>`,\n    cloudy: `\n        <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" class=\"weather-icon inline-icon\" fill=\"none\" stroke=\"currentColor\">\n            <path d=\"M18 10h-1.26A8 8 0 109 20h9a5 5 0 000-10z\"\n                  stroke-width=\"2\" stroke-linecap=\"round\"/>\n        </svg>`,\n    'partly cloudy': `\n        <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" class=\"weather-icon inline-icon\" fill=\"none\" stroke=\"currentColor\">\n            <path d=\"M12 4a4 4 0 100 8 4 4 0 000-8zM18 10h-1.26A4 4 0 109 20h9a5 5 0 000-10z\"\n                  stroke-width=\"2\" stroke-linecap=\"round\"/>\n        </svg>`,\n    rainy: `\n        <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" class=\"weather-icon inline-icon\" fill=\"none\" stroke=\"currentColor\">\n            <path d=\"M20 16.58A5 5 0 0018 7h-1.26A8 8 0 104 15.25M8 13v8M16 13v8M12 15v8\"\n                  stroke-width=\"2\" stroke-linecap=\"round\"/>\n        </svg>`,\n    drizzle: `\n        <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" class=\"weather-icon inline-icon\" fill=\"none\" stroke=\"currentColor\">\n            <path d=\"M20 16.58A5 5 0 0018 7h-1.26A8 8 0 104 15.25M8 13v8M16 13v8M12 15v8\"\n                  stroke-width=\"2\" stroke-linecap=\"round\"/>\n        </svg>`,\n    snow: `\n        <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" class=\"weather-icon inline-icon\" fill=\"none\" stroke=\"currentColor\">\n            <path d=\"M20 17.58A5 5 0 0018 8h-1.26A8 8 0 104 16.25M8 16h.01M8 20h.01M12 18h.01M12 22h.01M16 16h.01M16 20h.01\"\n                  stroke-width=\"2\" stroke-linecap=\"round\"/>\n        </svg>`,\n    foggy: `\n        <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" class=\"weather-icon inline-icon\" fill=\"none\" stroke=\"currentColor\">\n            <path d=\"M3 8h18M3 12h18M3 16h18\"\n                  stroke-width=\"2\" stroke-linecap=\"round\"/>\n        </svg>`\n};\n\n////////// Initialize Content Security Policy //////////\nif (window.trustedTypes && trustedTypes.createPolicy) {\n    trustedTypes.createPolicy('default', {\n        createHTML: string => string,\n        createScriptURL: string => string,\n        createScript: string => string\n    });\n}\n\n// Async Operation Timeout Protection\nfunction withTimeout(promise, ms = 5000) {\n    let timeoutId;\n\n    const timeoutPromise = new Promise((_, reject) => {\n        timeoutId = setTimeout(() => {\n            reject(new Error('Operation timed out'));\n        }, ms);\n    });\n\n    return Promise.race([\n        promise,\n        timeoutPromise\n    ]).finally(() => {\n        clearTimeout(timeoutId);\n    });\n}\n\nfunction sanitizeHTML(html) {\n    // Create a temporary div element\n    const div = document.createElement('div');\n    // Safely convert HTML to text\n    div.textContent = html;\n    // Get the sanitized HTML and remove dangerous patterns\n    return div.innerHTML\n        .replace(/<script[^>]*>.*?<\\/script>/gi, '') // Remove script tags\n        .replace(/on\\w+=\"[^\"]*\"/g, '') // Remove event handlers\n        .replace(/href=\"javascript:[^\"]*\"/g, '') // Remove javascript: URLs\n        .replace(/javascript:/gi, '') // Remove javascript: protocol\n        .replace(/data:/gi, '') // Remove data: URLs\n        .replace(/vbscript:/gi, ''); // Remove vbscript: protocol\n}\n\n////////// Accessibility Utilities //////////\nfunction trapFocus(element) {\n    const focusableElements = element.querySelectorAll(\n        'a[href], button:not([disabled]), input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex=\"-1\"])'\n    );\n    const firstFocusable = focusableElements[0];\n    const lastFocusable = focusableElements[focusableElements.length - 1];\n\n    function handleTabKey(e) {\n        if (e.key !== KEYS.TAB) return;\n\n        if (e.shiftKey && document.activeElement === firstFocusable) {\n            e.preventDefault();\n            lastFocusable.focus();\n        } else if (!e.shiftKey && document.activeElement === lastFocusable) {\n            e.preventDefault();\n            firstFocusable.focus();\n        }\n    }\n\n    element.addEventListener('keydown', handleTabKey);\n    return () => element.removeEventListener('keydown', handleTabKey);\n}\n\nfunction manageTabIndex(elements, selectedIndex) {\n    elements.forEach((element, index) => {\n        element.setAttribute('tabindex', index === selectedIndex ? '0' : '-1');\n    });\n}\n\n////////// Enhanced URL Validation //////////\nfunction isValidUrl(url) {\n    try {\n        // Create URL object (will throw if invalid)\n        const urlObj = new URL(url);\n\n        // Decode the URL to check for encoded malicious content\n        const decodedUrl = decodeURIComponent(url);\n\n        // List of allowed file extensions\n        const allowedExtensions = [\n            '.html', '.htm', '.php', '.asp',\n            '.aspx', '.jsp', '.json'\n        ];\n\n        // Check if the URL ends with an allowed extension\n        const hasValidExtension = allowedExtensions.some(ext =>\n            urlObj.pathname.toLowerCase().endsWith(ext)\n        );\n\n        // Combined security checks\n        return (\n            // Check origin matches current site\n            urlObj.origin === window.location.origin &&\n            // Check protocol matches current site\n            urlObj.protocol === window.location.protocol &&\n            // Ensure no credentials in URL\n            !urlObj.username &&\n            !urlObj.password &&\n            // Check for dangerous characters\n            !/[<>'\"`{}()\\[\\]]/.test(decodedUrl) &&\n            // Check for dangerous protocols\n            !/javascript:|data:|vbscript:|file:|blob:|ftp:|ws:|wss:/i\n                .test(decodedUrl) &&\n            // Verify file extension\n            hasValidExtension\n        );\n    } catch {\n        // If URL parsing fails, return false\n        return false;\n    }\n}\n\n////////// Optimized Input Validation //////////\nfunction validateInput(input, type) {\n    if (!input || !type) return false;\n    return SECURITY.inputPatterns[type]?.test(input) ?? false;\n}\n\n////////// Performance-Optimized Throttle //////////\nfunction throttle(func, limit) {\n    let lastRun, timeout;\n    return function(...args) {\n        if (!lastRun) {\n            func.apply(this, args);\n            lastRun = Date.now();\n        } else {\n            clearTimeout(timeout);\n            timeout = setTimeout(() => {\n                if ((Date.now() - lastRun) >= limit) {\n                    func.apply(this, args);\n                    lastRun = Date.now();\n                }\n            }, limit - (Date.now() - lastRun));\n        }\n    };\n}\n\n////////// Optimized Debounce //////////\nfunction debounce(func, wait, immediate = false) {\n    let timeout;\n    return function(...args) {\n        const later = () => {\n            timeout = null;\n            if (!immediate) func.apply(this, args);\n        };\n        const callNow = immediate && !timeout;\n        clearTimeout(timeout);\n        timeout = setTimeout(later, wait);\n        if (callNow) func.apply(this, args);\n    };\n}\n\n////////// Enhanced Text Sanitization //////////\nfunction sanitizeText(text, maxLength = 150) {\n    if (!text) return '';\n    const div = document.createElement('div');\n    div.textContent = text;\n    return div.textContent\n        .slice(0, maxLength)\n        .replace(SECURITY.urlPatterns.dangerous, '')\n        .replace(SECURITY.urlPatterns.symbols, '');\n}\n\n////////// Sidenotes Implementation //////////\nfunction initSidenotes() {\n    function processContent() {\n        console.log('Processing content');\n        const article = document.querySelector(SIDENOTES_CONFIG.articleSelector);\n        if (!article) {\n            console.log('No article found');\n            return;\n        }\n\n        const content = article.querySelector(SIDENOTES_CONFIG.contentSelector);\n        if (!content) {\n            console.log('No content found');\n            return;\n        }\n\n        // Get all paragraphs\n        const paragraphs = Array.from(content.getElementsByTagName('p'));\n        const footnotes = {};\n\n        // Regex patterns - will match [[n]] where n is any number of digits\n        const footnoteRegex = /^\\[\\[(\\d+)\\]\\]\\s*(.+)$/;\n        const referenceRegex = /\\[\\[(\\d+)\\]\\]/g;\n\n        // First pass: collect footnotes\n        paragraphs.forEach((p, index) => {\n            const text = p.textContent.trim();\n            const match = text.match(footnoteRegex);\n\n            if (match) {\n                const [_, number, noteContent] = match;\n                footnotes[number] = {\n                    content: noteContent,\n                    element: p\n                };\n                p.style.display = 'none'; // Hide the footnote paragraph\n            }\n        });\n\n        // Second pass: replace references and create sidenotes\n        if (Object.keys(footnotes).length > 0) {\n            // Create sidenotes container\n            const sidenoteContainer = document.createElement('div');\n            sidenoteContainer.className = SIDENOTES_CONFIG.notesWrapperClass;\n\n            // Create mobile sidenotes container\n            const mobileSidenoteContainer = document.createElement('div');\n            mobileSidenoteContainer.className = SIDENOTES_CONFIG.mobileNotesClass;\n            mobileSidenoteContainer.style.display = 'none';\n\n            // Process references\n            paragraphs.forEach(p => {\n                const text = p.innerHTML;\n                if (text.includes('[[')) {\n                    p.innerHTML = text.replace(referenceRegex, (match, num) => {\n                        if (footnotes[num]) {\n                            return `<sup class=\"footnote-ref\" id=\"ref-${num}\">${num}</sup>`;\n                        }\n                        return match;\n                    });\n                }\n            });\n\n            // Create and position sidenotes\n            Object.entries(footnotes).forEach(([num, data]) => {\n                // Create desktop sidenote\n                const sidenote = createSidenote(num, data.content);\n                sidenoteContainer.appendChild(sidenote);\n\n                // Create mobile sidenote (clone)\n                const mobileSidenote = createSidenote(num, data.content);\n                mobileSidenote.classList.add('mobile');\n                mobileSidenoteContainer.appendChild(mobileSidenote);\n            });\n\n            content.appendChild(sidenoteContainer);\n\n            // Insert mobile container before footer\n            const footer = article.querySelector(SIDENOTES_CONFIG.footerSelector);\n            if (footer) {\n                article.insertBefore(mobileSidenoteContainer, footer);\n            }\n\n            // Initial positioning and display\n            handleResponsiveLayout();\n            positionSidenotes();\n        }\n    }\n\n    function createSidenote(num, content) {\n        const sidenote = document.createElement('aside');\n        sidenote.className = 'sidenote';\n        sidenote.id = `note-${num}`;\n        sidenote.innerHTML = `\n            <div class=\"note-content\">\n                <span class=\"note-number\">${num}</span>\n                <div class=\"note-text\">${content}</div>\n            </div>\n        `;\n        return sidenote;\n    }\n\n    function positionSidenotes() {\n        const content = document.querySelector(SIDENOTES_CONFIG.contentSelector);\n        const sidenotes = document.querySelectorAll(`.${SIDENOTES_CONFIG.notesWrapperClass} .sidenote`);\n\n        if (window.innerWidth <= SIDENOTES_CONFIG.mobileBreakpoint) return;\n\n        sidenotes.forEach((sidenote, index) => {\n            const num = sidenote.id.replace('note-', '');\n            const ref = document.getElementById(`ref-${num}`);\n\n            if (ref && content) {\n                const refRect = ref.getBoundingClientRect();\n                const contentRect = content.getBoundingClientRect();\n                let topPosition = refRect.top - contentRect.top - 12;\n\n                // Adjust position if there's overlap with previous sidenote\n                if (index > 0) {\n                    const prevSidenote = sidenotes[index - 1];\n                    const prevRect = prevSidenote.getBoundingClientRect();\n                    const minGap = 12;\n\n                    if (topPosition < prevRect.bottom - contentRect.top + minGap) {\n                        topPosition = prevRect.bottom - contentRect.top + minGap;\n                    }\n                }\n\n                sidenote.style.top = `${Math.round(topPosition)}px`;\n            }\n        });\n    }\n\n    function handleResponsiveLayout() {\n        const desktopNotes = document.querySelector(`.${SIDENOTES_CONFIG.notesWrapperClass}`);\n        const mobileNotes = document.querySelector(`.${SIDENOTES_CONFIG.mobileNotesClass}`);\n\n        if (!desktopNotes || !mobileNotes) return;\n\n        if (window.innerWidth <= SIDENOTES_CONFIG.mobileBreakpoint) {\n            desktopNotes.style.display = 'none';\n            mobileNotes.style.display = 'block';\n        } else {\n            desktopNotes.style.display = 'block';\n            mobileNotes.style.display = 'none';\n        }\n    }\n\n    // Initialize with a slight delay to ensure content is loaded\n    setTimeout(processContent, 500);\n\n    // Handle window resize\n    window.addEventListener('resize', debounce(() => {\n        handleResponsiveLayout();\n        requestAnimationFrame(positionSidenotes);\n    }, 100));\n\n    // Add click handler for highlighting and scrolling\n    document.addEventListener('click', (e) => {\n        if (e.target.matches('.footnote-ref')) {\n            const num = e.target.id.replace('ref-', '');\n\n            // Remove highlights from all sidenotes\n            document.querySelectorAll('.sidenote').forEach(note => {\n                note.classList.remove('highlight');\n            });\n\n            // Specifically target the mobile sidenote if in mobile view\n            if (window.innerWidth <= SIDENOTES_CONFIG.mobileBreakpoint) {\n                const mobileSidenote = document.querySelector(`.${SIDENOTES_CONFIG.mobileNotesClass} #note-${num}`);\n                if (mobileSidenote) {\n                    mobileSidenote.classList.add('highlight');\n                    mobileSidenote.offsetHeight; // Force a reflow\n                    mobileSidenote.style.backgroundColor = '#ffeb99';\n                    requestAnimationFrame(() => {\n                        mobileSidenote.style.backgroundColor = '#fffdf0';\n                    });\n                    setTimeout(() => {\n                        mobileSidenote.scrollIntoView({\n                            behavior: 'smooth',\n                            block: 'center'\n                        });\n                    }, 50);\n                }\n            } else {\n                // Desktop view - highlight both instances\n                const sidenotes = document.querySelectorAll(`#note-${num}`);\n                sidenotes.forEach(sidenote => {\n                    if (sidenote) {\n                        sidenote.classList.add('highlight');\n                    }\n                });\n            }\n        }\n    });\n}\n\nfunction createFilterDropdown() {\n    // Define icons for each filter type\n    const FILTER_ICONS = {\n        all: `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-layout-grid\"><rect width=\"7\" height=\"7\" x=\"3\" y=\"3\" rx=\"1\"/><rect width=\"7\" height=\"7\" x=\"14\" y=\"3\" rx=\"1\"/><rect width=\"7\" height=\"7\" x=\"14\" y=\"14\" rx=\"1\"/><rect width=\"7\" height=\"7\" x=\"3\" y=\"14\" rx=\"1\"/></svg>`,\n        article: `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M4 22h16a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v16a2 2 0 0 1-2 2Zm0 0a2 2 0 0 1-2-2v-9c0-1.1.9-2 2-2h2\"/><path d=\"M18 14h-8\"/><path d=\"M15 18h-5\"/><path d=\"M10 6h8v4h-8V6Z\"/></svg>`,\n        bookmarks: `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-bookmark\"><path d=\"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z\"/></svg>`,\n        notes: `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-sticky-note\"><path d=\"M16 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V8Z\"/><path d=\"M15 3v4a2 2 0 0 0 2 2h4\"/></svg>`,\n        quotes: `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-quote\"><path d=\"M16 3a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2 1 1 0 0 1 1 1v1a2 2 0 0 1-2 2 1 1 0 0 0-1 1v2a1 1 0 0 0 1 1 6 6 0 0 0 6-6V5a2 2 0 0 0-2-2z\"/><path d=\"M5 3a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2 1 1 0 0 1 1 1v1a2 2 0 0 1-2 2 1 1 0 0 0-1 1v2a1 1 0 0 0 1 1 6 6 0 0 0 6-6V5a2 2 0 0 0-2-2z\"/></svg>`\n    };\n\n    const container = document.createElement('div');\n    container.id = FILTER_CONFIG.containerId;\n    container.className = 'post-type-filter';\n\n    const button = document.createElement('button');\n    button.className = 'filter-button';\n    button.setAttribute('aria-expanded', 'false');\n    button.setAttribute('aria-haspopup', 'listbox');\n\n    const staticText = document.createElement('span');\n    staticText.className = 'filter-static-text';\n    staticText.textContent = 'Filter Articles By: ';\n\n    const dynamicText = document.createElement('span');\n    dynamicText.className = 'filter-button-text';\n    dynamicText.textContent = 'All Posts';\n\n    const buttonIcon = document.createElement('span');\n    buttonIcon.className = 'filter-button-icon';\n    buttonIcon.innerHTML = `\n        <svg width=\"12\" height=\"12\" viewBox=\"0 0 12 12\">\n            <path d=\"M2 4l4 4 4-4\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\"/>\n        </svg>\n    `;\n\n    button.appendChild(staticText);\n    button.appendChild(dynamicText);\n    button.appendChild(buttonIcon);\n\n    const dropdown = document.createElement('div');\n    dropdown.className = 'filter-dropdown';\n    dropdown.setAttribute('role', 'listbox');\n    dropdown.setAttribute('aria-hidden', 'true');\n    dropdown.style.display = 'none';\n\n    const ul = document.createElement('ul');\n    FILTER_CONFIG.types.forEach(type => {\n        const li = document.createElement('li');\n        li.setAttribute('role', 'option');\n        li.setAttribute('data-value', type.id);\n        li.setAttribute('tabindex', '-1');\n\n        // Add icon and text wrapper\n        const iconSpan = document.createElement('span');\n        iconSpan.className = 'filter-option-icon';\n        iconSpan.innerHTML = FILTER_ICONS[type.id] || FILTER_ICONS['all'];\n\n        const textSpan = document.createElement('span');\n        textSpan.className = 'filter-option-text';\n        textSpan.textContent = type.label;\n\n        li.appendChild(iconSpan);\n        li.appendChild(textSpan);\n\n        if (type.id === 'all') {\n            li.setAttribute('aria-selected', 'true');\n        }\n        ul.appendChild(li);\n    });\n\n    dropdown.appendChild(ul);\n    container.appendChild(button);\n    container.appendChild(dropdown);\n\n    return container;\n}\n\nfunction initPostFilter(iso) {\nconst articleList = document.querySelector('.article-list');\nif (!articleList) return;\n\n// Create filter dropdown\nconst filter = createFilterDropdown();\n\n// Set initial styles\nObject.assign(filter.style, {\n    opacity: '0',\n    visibility: 'hidden',\n    transition: 'opacity 0.3s ease-out',\n    height: '100%'\n});\n\n// Insert filter after the header-dropdown\nconst headerDropdown = document.querySelector('.header-dropdown');\nif (headerDropdown) {\n    headerDropdown.after(filter);\n}\n\n// Function to check scroll position and toggle filter visibility\nfunction checkScrollPosition() {\n    // Get article list position and calculate trigger point\n    const articleListPosition = articleList.getBoundingClientRect().top + window.scrollY;\n    // Trigger 300px before reaching the article list\n    const scrollTriggerPoint = articleListPosition - 200;\n\n    if (window.scrollY > scrollTriggerPoint) {\n        filter.style.visibility = 'visible';\n        requestAnimationFrame(() => {\n            filter.style.opacity = '1';\n        });\n    } else {\n        filter.style.opacity = '0';\n        setTimeout(() => {\n            if (filter.style.opacity === '0') {\n                filter.style.visibility = 'hidden';\n            }\n        }, 300);\n    }\n}\n\n// Add scroll listener with debounce for performance\nwindow.addEventListener('scroll', debounce(checkScrollPosition, 10));\n\n// Also recalculate on window resize\nwindow.addEventListener('resize', debounce(checkScrollPosition, 100));\n\n// Initial check\ncheckScrollPosition();\n\n// Get filter elements\nconst filterButton = filter.querySelector('.filter-button');\nconst filterDropdown = filter.querySelector('.filter-dropdown');\nconst filterOptions = filter.querySelectorAll('li');\nconst buttonText = filter.querySelector('.filter-button-text');\n\n    // Position dropdown function\n    const positionDropdown = () => {\n        const buttonRect = filterButton.getBoundingClientRect();\n        filterDropdown.style.position = 'fixed';\n        filterDropdown.style.top = `${buttonRect.bottom + 8}px`; // 8px gap\n        filterDropdown.style.left = `${buttonRect.left}px`;\n        filterDropdown.style.width = `${Math.max(buttonRect.width, 200)}px`; // At least 200px wide\n    };\n\n    // Toggle dropdown\n    const toggleDropdown = (show) => {\n        if (show) {\n            filterDropdown.style.display = 'block';\n            positionDropdown();\n        } else {\n            filterDropdown.style.display = 'none';\n        }\n        filterButton.setAttribute(ARIA_ATTRS.EXPANDED, show.toString());\n        filterDropdown.setAttribute(ARIA_ATTRS.HIDDEN, (!show).toString());\n    };\n\n    // Handle filter selection\nconst handleFilterSelect = (typeId) => {\n        filterOptions.forEach(option => {\n            option.setAttribute('aria-selected', option.dataset.value === typeId);\n        });\n\n        // Update button text\n        const selectedType = FILTER_CONFIG.types.find(t => t.id === typeId);\n        buttonText.textContent = selectedType.label;\n\n        // Add/remove active indicator\n        filterButton.classList.toggle('filter-active', typeId !== 'all');\n\n        // Add accessibility announcement\n        const announcement = document.createElement('div');\n        announcement.setAttribute('role', 'status');\n        announcement.className = 'visually-hidden';\n        announcement.textContent = `Showing ${selectedType.label}`;\n        document.body.appendChild(announcement);\n        setTimeout(() => announcement.remove(), 1000);\n\n        toggleDropdown(false);\n        localStorage.setItem('selectedPostType', typeId);\n\n        if (iso) {\n            if (typeId === 'all') {\n                iso.arrange({ filter: '*' });\n            } else {\n                iso.arrange({ filter: `.${typeId}` });\n            }\n        }\n    };\n\n    // Event Listeners\n    filterButton.addEventListener('click', () => {\n        const isExpanded = filterButton.getAttribute(ARIA_ATTRS.EXPANDED) === 'true';\n        toggleDropdown(!isExpanded);\n    });\n\n    filterOptions.forEach(option => {\n        option.addEventListener('click', () => {\n            handleFilterSelect(option.dataset.value);\n        });\n    });\n\n    // Close dropdown when clicking outside\n    document.addEventListener('click', (e) => {\n        if (!filter.contains(e.target)) {\n            toggleDropdown(false);\n        }\n    });\n\n    // Handle keyboard navigation\n    filter.addEventListener('keydown', (e) => {\n        const isExpanded = filterButton.getAttribute(ARIA_ATTRS.EXPANDED) === 'true';\n\n        switch (e.key) {\n            case KEYS.ESCAPE:\n                if (isExpanded) {\n                    toggleDropdown(false);\n                    filterButton.focus();\n                }\n                break;\n            case KEYS.ENTER:\n            case KEYS.SPACE:\n                if (e.target.tagName === 'LI') {\n                    handleFilterSelect(e.target.dataset.value);\n                }\n                break;\n            case KEYS.UP:\n            case KEYS.DOWN:\n                if (isExpanded) {\n                    e.preventDefault();\n                    const currentOption = document.activeElement;\n                    const options = Array.from(filterOptions);\n                    const currentIndex = options.indexOf(currentOption);\n                    let nextIndex;\n\n                    if (e.key === KEYS.UP) {\n                        nextIndex = currentIndex > 0 ? currentIndex - 1 : options.length - 1;\n                    } else {\n                        nextIndex = currentIndex < options.length - 1 ? currentIndex + 1 : 0;\n                    }\n\n                    options[nextIndex].focus();\n                }\n                break;\n        }\n    });\n\n    // Update position on scroll/resize\n    window.addEventListener('scroll', () => {\n        if (filterButton.getAttribute(ARIA_ATTRS.EXPANDED) === 'true') {\n            positionDropdown();\n        }\n    }, { passive: true });\n\n    window.addEventListener('resize', debounce(() => {\n        if (filterButton.getAttribute(ARIA_ATTRS.EXPANDED) === 'true') {\n            positionDropdown();\n        }\n    }, 100));\n\n    // Restore previous selection\n    const savedType = localStorage.getItem('selectedPostType');\n    if (savedType) {\n        handleFilterSelect(savedType);\n    }\n\n    return handleFilterSelect;\n}\n\n////////// Testimonials Implementation //////////\nfunction initTestimonials() {\n    const testimonialElement = document.getElementById('testimonal');\n    if (!testimonialElement) return;\n\n    // Create a shuffled array of indices\n    let indices = Array.from({ length: TESTIMONIALS_CONFIG.testimonials.length }, (_, i) => i);\n    let currentIndex = 0;\n\n    // Fisher-Yates shuffle algorithm\n    function shuffleArray(array) {\n        for (let i = array.length - 1; i > 0; i--) {\n            const j = Math.floor(Math.random() * (i + 1));\n            [array[i], array[j]] = [array[j], array[i]];\n        }\n        return array;\n    }\n\n    // Initial shuffle\n    indices = shuffleArray(indices);\n\n// Keep your existing HTML creation function\nfunction createTestimonialHTML(testimonial) {\n    // Sanitize the input data\n    const sanitizedQuote = sanitizeHTML(testimonial.quote);\n    const sanitizedAuthor = sanitizeHTML(testimonial.author);\n    const sanitizedLink = sanitizeHTML(testimonial.link);\n    // Construct the correct asset path by prepending /assets/\n    const avatarPath = `/assets/${testimonial.avatar}`;\n    const sanitizedAvatar = sanitizeHTML(avatarPath);\n\n    // Replace straight apostrophes with curly ones\n    const withCurlyApostrophes = sanitizedQuote.replaceAll(\"'\", \"\\u2019\");\n\n    return `<div class=\"testimonial-content\">\n            <q>${withCurlyApostrophes}</q>\n            <cite><img class=\"rounded-full inline mr-1\"\n                 src=\"${sanitizedAvatar}\"\n                 width=\"45\"\n                 height=\"45\"\n                 alt=\"${sanitizedAuthor}'s avatar\"\n                 onerror=\"this.style.display='none'\">\n                 <a href=\"${sanitizedLink}\">${sanitizedAuthor}<svg xmlns=\"http://www.w3.org/2000/svg\"\n                      width=\"16\"\n                      height=\"16\"\n                      viewBox=\"0 0 24 24\"\n                      fill=\"none\"\n                      stroke=\"currentColor\"\n                      stroke-width=\"1.25\"\n                      stroke-linecap=\"round\"\n                      stroke-linejoin=\"round\">\n                      <path d=\"M5 12h14\"/>\n                      <path d=\"m12 5 7 7-7 7\"/>\n                 </svg></a>\n            </cite>\n        </div>`;\n}\n\n    function updateTestimonial() {\n        if (!testimonialElement) return;\n\n        const content = testimonialElement.querySelector('.testimonial-content');\n        if (content) {\n            content.style.opacity = '0';\n            content.style.transform = 'translate(-50%, -40%)';\n\n            setTimeout(() => {\n                // Get testimonial using shuffled index\n                const testimonial = TESTIMONIALS_CONFIG.testimonials[indices[currentIndex]];\n\n                // Add debugging\n                console.log('Loading testimonial:', {\n                    author: testimonial.author,\n                    avatarPath: `/assets/${testimonial.avatar}`\n                });\n\n                testimonialElement.innerHTML = createTestimonialHTML(testimonial);\n                const newContent = testimonialElement.querySelector('.testimonial-content');\n                if (newContent) {\n                    newContent.style.opacity = '1';\n                    newContent.style.transform = 'translate(-50%, -50%)';\n                }\n\n                // Increment index and reshuffle if we've shown all quotes\n                currentIndex = (currentIndex + 1) % indices.length;\n                if (currentIndex === 0) {\n                    indices = shuffleArray(indices);\n                }\n            }, TESTIMONIALS_CONFIG.fadeTransitionMs);\n        }\n    }\n\n    // Initialize with first testimonial\n    updateTestimonial();\n\n    // Set up interval for testimonial rotation\n    setInterval(updateTestimonial, TESTIMONIALS_CONFIG.updateInterval);\n}\n\nfunction initWeatherDisplay() {\n    const tempElement = document.getElementById('current-temp');\n    const conditionElement = document.getElementById('current-condition');\n    if (!tempElement || !conditionElement) return;\n\n    // Map WMO weather codes to simple words\n    // https://open-meteo.com/en/docs#weathervariables\n    const weatherMap = {\n        'sunny': [0, 1],\n        'partly cloudy': [2],\n        'cloudy': [3],\n        'foggy': [45, 48],\n        'drizzle': [51, 53, 55],\n        'rain': [61, 63, 65, 80, 81, 82],\n        'snow': [71, 73, 75, 77, 85, 86],\n        'thunderstorm': [95, 96, 99]\n    };\n\n    function getOneWordWeather(code) {\n        for (const [word, codes] of Object.entries(weatherMap)) {\n            if (codes.includes(code)) return word;\n        }\n        return 'cloudy'; // Default fallback\n    }\n\n    function updateWeatherIcon(condition) {\n        const iconTemplate = WEATHER_ICONS[condition] || WEATHER_ICONS.cloudy;\n        const tempLi = tempElement.closest('li');\n        const existingIcon = tempLi.querySelector('.weather-icon');\n\n        if (existingIcon) {\n            existingIcon.parentElement.remove();\n        }\n\n        const iconContainer = document.createElement('span');\n        iconContainer.className = 'weather-icon-container';\n        iconContainer.innerHTML = iconTemplate;\n\n        tempLi.insertBefore(iconContainer, tempLi.firstChild);\n    }\n\nasync function getWeatherData() {\n        try {\n            // Clear existing cache first\n            localStorage.removeItem('weather_cache');\n\n            const lat = 43.66147;\n            const lon = -70.25533;\n            const url = new URL('https://api.open-meteo.com/v1/forecast');\n            url.searchParams.set('latitude', lat);\n            url.searchParams.set('longitude', lon);\n            url.searchParams.set('current', 'temperature_2m,weather_code');\n            url.searchParams.set('temperature_unit', 'fahrenheit');\n            url.searchParams.set('_cb', Math.random());\n\n            const response = await fetch(url);\n            if (!response.ok) throw new Error('Weather API request failed');\n\n            const data = await response.json();\n\n            // Use ISO string for timestamp\n            const result = {\n                temp: Math.round(data.current.temperature_2m),\n                condition: getOneWordWeather(data.current.weather_code),\n                lastUpdated: new Date().toISOString()\n            };\n\n            console.log('Weather update:', {\n                temp: result.temp,\n                condition: result.condition,\n                lastUpdated: result.lastUpdated,\n                localTime: new Date().toLocaleString('en-US', { timeZone: 'America/New_York' })\n            });\n\n            localStorage.setItem('weather_cache', JSON.stringify(result));\n\n            return {\n                temp: result.temp,\n                condition: result.condition\n            };\n\n        } catch (error) {\n            console.error('Error fetching weather:', error);\n            return { temp: '--', condition: 'cloudy' };\n        }\n    }\n\n    async function updateDisplay() {\n        try {\n            // Clear any existing interval when we start a new update\n            if (window.weatherUpdateInterval) {\n                clearInterval(window.weatherUpdateInterval);\n            }\n\n            const updateWeatherDisplay = async () => {\n                try {\n                    const weather = await getWeatherData();\n\n                    if (!tempElement || !conditionElement) {\n                        console.error('Weather elements not found');\n                        return;\n                    }\n\n                    tempElement.textContent = `${weather.temp}°F`;\n                    conditionElement.textContent = ` ${weather.condition}`;\n                    updateWeatherIcon(weather.condition);\n\n                    tempElement.setAttribute('aria-label',\n                        `Current temperature is ${weather.temp} degrees Fahrenheit and ${weather.condition}`\n                    );\n                } catch (error) {\n                    console.error('Error updating weather display:', error);\n                }\n            };\n\n            // Initial update\n            await updateWeatherDisplay();\n\n            // Set up periodic updates every 3 hours\n            const threeHours = 3 * 60 * 60 * 1000; // 3 hours in milliseconds\n            window.weatherUpdateInterval = setInterval(updateWeatherDisplay, threeHours);\n\n            // Clean up interval when page is hidden\n            document.addEventListener('visibilitychange', () => {\n                if (document.hidden && window.weatherUpdateInterval) {\n                    clearInterval(window.weatherUpdateInterval);\n                } else if (!document.hidden && !window.weatherUpdateInterval) {\n                    // Check when was the last update\n                    const cached = localStorage.getItem('weather_cache');\n                    if (cached) {\n                        const data = JSON.parse(cached);\n                        const lastUpdate = new Date(data.lastUpdated);\n                        const threeHoursAgo = new Date(Date.now() - threeHours);\n\n                        // Only update if last update was more than 3 hours ago\n                        if (lastUpdate < threeHoursAgo) {\n                            updateWeatherDisplay();\n                            window.weatherUpdateInterval = setInterval(updateWeatherDisplay, threeHours);\n                        }\n                    } else {\n                        // No cache exists, do an update\n                        updateWeatherDisplay();\n                        window.weatherUpdateInterval = setInterval(updateWeatherDisplay, threeHours);\n                    }\n                }\n            });\n\n        } catch (error) {\n            console.error('Error in weather update system:', error);\n        }\n    }\n\n    // Start the weather display system\n    updateDisplay();\n}\n\n////////// Knicks Championship Counter //////////\nfunction initKnicksCounter() {\n    const counterElement = document.getElementById('knicks-counter');\n    if (!counterElement) return;\n\n    function calculateDays() {\n        const championship = new Date('1973-05-10T00:00:00-05:00'); // EST timezone\n        const now = new Date();\n        const est = new Date(now.toLocaleString('en-US', { timeZone: 'America/New_York' }));\n        const diff = est - championship;\n        const daysSince = Math.floor(diff / (1000 * 60 * 60 * 24));\n        counterElement.textContent = `${daysSince.toLocaleString()} Days Ago`;\n    }\n\n    // Calculate initial days\n    calculateDays();\n\n    // Calculate time until next midnight EST\n    function setMidnightUpdate() {\n        const now = new Date();\n        const est = new Date(now.toLocaleString('en-US', { timeZone: 'America/New_York' }));\n        const tomorrow = new Date(est);\n        tomorrow.setDate(tomorrow.getDate() + 1);\n        tomorrow.setHours(0, 0, 0, 0);\n        const msUntilMidnight = tomorrow - est;\n\n        // Update at midnight\n        setTimeout(() => {\n            calculateDays();\n            // After first midnight, update every 24 hours\n            setInterval(calculateDays, 24 * 60 * 60 * 1000);\n        }, msUntilMidnight);\n    }\n\n    setMidnightUpdate();\n}\n\nfunction initRelatedArticlesPanel() {\n    // Securely query elements using trusted class names\n    const elements = {\n        trigger: document.querySelector(`.${CSS.escape(RELATED_PANEL_CONFIG.triggerButtonClass)}`),\n        panel: document.querySelector(`.${CSS.escape(RELATED_PANEL_CONFIG.panelClass)}`),\n        overlay: document.querySelector(`.${CSS.escape(RELATED_PANEL_CONFIG.overlayClass)}`),\n        closeBtn: document.querySelector(`.${CSS.escape(RELATED_PANEL_CONFIG.closeBtnClass)}`)\n    };\n\n    // Validate all required elements exist\n    if (!Object.values(elements).every(Boolean)) {\n        console.error('Required elements not found for related articles panel');\n        return;\n    }\n\n    // Rate limiting setup\n    const rateLimiter = {\n        attempts: 0,\n        lastReset: Date.now(),\n\n        checkLimit() {\n            const now = Date.now();\n            if (now - this.lastReset > RELATED_PANEL_CONFIG.timeWindowMs) {\n                this.attempts = 0;\n                this.lastReset = now;\n            }\n\n            if (this.attempts >= RELATED_PANEL_CONFIG.maxOpenAttempts) {\n                return false;\n            }\n\n            this.attempts++;\n            return true;\n        }\n    };\n\n    // Secure class manipulation\n    function togglePanelClasses(isOpen) {\n        const { activeClass, panelOpenClass } = RELATED_PANEL_CONFIG;\n\n        try {\n            if (isOpen) {\n                elements.panel.classList.add(activeClass);\n                elements.overlay.classList.add(activeClass);\n                document.body.classList.add(panelOpenClass);\n            } else {\n                elements.panel.classList.remove(activeClass);\n                elements.overlay.classList.remove(activeClass);\n                document.body.classList.remove(panelOpenClass);\n            }\n        } catch (error) {\n            console.error('Error toggling panel classes:', error);\n            // Ensure panel is closed on error\n            elements.panel.classList.remove(activeClass);\n            elements.overlay.classList.remove(activeClass);\n            document.body.classList.remove(panelOpenClass);\n        }\n    }\n\n    // Secure ARIA attribute management\n    function updateAriaAttributes(isOpen) {\n        try {\n            elements.trigger.setAttribute('aria-expanded', String(isOpen));\n            elements.panel.setAttribute('aria-hidden', String(!isOpen));\n            elements.overlay.setAttribute('aria-hidden', String(!isOpen));\n        } catch (error) {\n            console.error('Error updating ARIA attributes:', error);\n            // Reset to safe state on error\n            elements.trigger.setAttribute('aria-expanded', 'false');\n            elements.panel.setAttribute('aria-hidden', 'true');\n            elements.overlay.setAttribute('aria-hidden', 'true');\n        }\n    }\n\n    function openPanel() {\n        if (!rateLimiter.checkLimit()) {\n            console.warn('Rate limit exceeded for panel opening');\n            return;\n        }\n\n        togglePanelClasses(true);\n        updateAriaAttributes(true);\n\n        // Secure focus management\n        setTimeout(() => elements.closeBtn.focus(), 100);\n    }\n\n    function closePanel() {\n        togglePanelClasses(false);\n        updateAriaAttributes(false);\n\n        // Secure focus management\n        setTimeout(() => elements.trigger.focus(), 100);\n    }\n\n    // Secure event listener cleanup\n    const removeEventListeners = new Set();\n\n    // Secure event handlers\n    function addSecureEventListener(element, event, handler, options = {}) {\n        const secureHandler = (e) => {\n            try {\n                handler(e);\n            } catch (error) {\n                console.error(`Error in ${event} handler:`, error);\n                closePanel(); // Ensure panel closes on error\n            }\n        };\n\n        element.addEventListener(event, secureHandler, options);\n        removeEventListeners.add(() => {\n            element.removeEventListener(event, secureHandler, options);\n        });\n    }\n\n    // Add event listeners with error boundaries\n    addSecureEventListener(elements.trigger, 'click', openPanel);\n    addSecureEventListener(elements.closeBtn, 'click', closePanel);\n    addSecureEventListener(elements.overlay, 'click', closePanel);\n\n    // Secure keyboard navigation\n    addSecureEventListener(document, 'keydown', (e) => {\n        if (e.key === 'Escape' &&\n            elements.panel.classList.contains(RELATED_PANEL_CONFIG.activeClass)) {\n            closePanel();\n        }\n    });\n\n    // Secure focus trap\n    addSecureEventListener(elements.panel, 'keydown', (e) => {\n        if (e.key !== 'Tab') return;\n\n        // Safely query focusable elements\n        const focusableElements = Array.from(\n            elements.panel.querySelectorAll(RELATED_PANEL_CONFIG.focusableSelectors)\n        ).filter(el => !el.hasAttribute('disabled') &&\n                      el.getAttribute('tabindex') !== '-1' &&\n                      el.offsetParent !== null); // Check visibility\n\n        if (focusableElements.length === 0) return;\n\n        const firstFocusable = focusableElements[0];\n        const lastFocusable = focusableElements[focusableElements.length - 1];\n        const isFirstElement = document.activeElement === firstFocusable;\n        const isLastElement = document.activeElement === lastFocusable;\n\n        if (e.shiftKey && isFirstElement) {\n            e.preventDefault();\n            lastFocusable.focus();\n        } else if (!e.shiftKey && isLastElement) {\n            e.preventDefault();\n            firstFocusable.focus();\n        }\n    });\n\n    // Cleanup function\n    return function cleanup() {\n        removeEventListeners.forEach(remove => remove());\n        removeEventListeners.clear();\n    };\n}\n\n////////// Related Articles Panel Interactions //////////\nfunction initRelatedArticleInteractions() {\n    const stacks = document.querySelectorAll('.article-stack');\n\n    stacks.forEach(stack => {\n        const cards = stack.querySelectorAll('.panel-article-card');\n\n        cards.forEach((card, index) => {\n            // Set initial z-indexes explicitly\n            if (index === 0) card.style.zIndex = '3';\n            if (index === 1) card.style.zIndex = '2';\n            if (index === 2) card.style.zIndex = '1';\n\n            card.addEventListener('click', () => {\n                // Get clicked card index\n                const clickedIndex = Array.from(cards).indexOf(card);\n\n                // Only proceed if not the top card\n                if (clickedIndex !== 0) {\n                    // Find the current top card\n                    const topCard = stack.querySelector('.panel-article-card:first-child');\n\n                    // Swap z-indexes\n                    const clickedZIndex = card.style.zIndex;\n                    card.style.zIndex = topCard.style.zIndex;\n                    topCard.style.zIndex = clickedZIndex;\n                }\n            });\n        });\n    });\n}\n\n////////// Tag Scroll Implementation //////////\nfunction initTagScroll() {\n    const container = document.querySelector('.filter-btns');\n    const leftBtn = document.querySelector('.scroll-left');\n    const rightBtn = document.querySelector('.scroll-right');\n\n    if (!container || !leftBtn || !rightBtn) return;\n\n    // Variables for drag scrolling\n    let isMouseDown = false;\n    let startX;\n    let scrollLeft;\n\n    // Touch and mouse event handlers\n    function handleDragStart(e) {\n        isMouseDown = true;\n        container.style.cursor = 'grabbing';\n        container.style.userSelect = 'none';\n\n        // Get starting position (works for both mouse and touch)\n        startX = (e.pageX || e.touches[0].pageX) - container.offsetLeft;\n        scrollLeft = container.scrollLeft;\n    }\n\n    function handleDragEnd() {\n        isMouseDown = false;\n        container.style.cursor = 'grab';\n        container.style.removeProperty('user-select');\n    }\n\n    function handleDragMove(e) {\n        if (!isMouseDown) return;\n        e.preventDefault();\n\n        // Calculate new position (works for both mouse and touch)\n        const x = (e.pageX || e.touches[0].pageX) - container.offsetLeft;\n        const walk = (x - startX) * 2; // Multiply by 2 for faster scrolling\n        container.scrollLeft = scrollLeft - walk;\n    }\n\n    // Add mouse event listeners for desktop\n    container.addEventListener('mousedown', handleDragStart);\n    container.addEventListener('mouseleave', handleDragEnd);\n    container.addEventListener('mouseup', handleDragEnd);\n    container.addEventListener('mousemove', handleDragMove);\n\n    // Add touch event listeners for mobile\n    container.addEventListener('touchstart', handleDragStart);\n    container.addEventListener('touchend', handleDragEnd);\n    container.addEventListener('touchmove', handleDragMove);\n\n    // Your existing scroll button code\n    function checkScroll() {\n        const { scrollLeft, scrollWidth, clientWidth } = container;\n        leftBtn.classList.toggle('visible', scrollLeft > 0);\n        rightBtn.classList.toggle('visible', scrollLeft < scrollWidth - clientWidth - 1);\n    }\n\n    function scroll(direction) {\n        const scrollAmount = 200;\n        container.scrollBy({\n            left: direction === 'left' ? -scrollAmount : scrollAmount,\n            behavior: 'smooth'\n        });\n    }\n\n    checkScroll();\n    container.addEventListener('scroll', checkScroll);\n    window.addEventListener('resize', checkScroll);\n    leftBtn.addEventListener('click', () => scroll('left'));\n    rightBtn.addEventListener('click', () => scroll('right'));\n}\n\nfunction initHeaderDropdown() {\n    const dropdown = document.querySelector('.header-dropdown');\n    const button = dropdown.querySelector('.header-dropdown-button');\n    const content = dropdown.querySelector('.header-dropdown-content');\n    const overlay = dropdown.querySelector('.header-dropdown-overlay');\n    const backdrop = dropdown.querySelector('.header-dropdown-backdrop');\n\n    let isOpen = false;\n    let timeoutId = null;\n\n    function closeDropdown() {\n        isOpen = false;\n        dropdown.classList.remove('active');\n        button.setAttribute('aria-expanded', 'false');\n        content.setAttribute('aria-hidden', 'true');\n        overlay.style.display = 'none';\n        backdrop.style.display = 'none';\n    }\n\n    function openDropdown() {\n        isOpen = true;\n        dropdown.classList.add('active');\n        button.setAttribute('aria-expanded', 'true');\n        content.setAttribute('aria-hidden', 'false');\n        overlay.style.display = 'block';\n        backdrop.style.display = 'block';\n    }\n\n    // Toggle on button click\n    button.addEventListener('click', (e) => {\n        e.stopPropagation();\n        if (isOpen) {\n            closeDropdown();\n        } else {\n            openDropdown();\n        }\n    });\n\n    // Handle mouse interactions with both content and overlay\n    function handleMouseLeave() {\n        if (isOpen) {\n            timeoutId = setTimeout(closeDropdown, 100);\n        }\n    }\n\n    function handleMouseEnter() {\n        if (timeoutId) {\n            clearTimeout(timeoutId);\n            timeoutId = null;\n        }\n    }\n\n    // Apply mouse events to both dropdown and content\n    [dropdown, content].forEach(element => {\n        element.addEventListener('mouseleave', handleMouseLeave);\n        element.addEventListener('mouseenter', handleMouseEnter);\n    });\n\n    // Close when clicking overlay or outside\n    [overlay, backdrop].forEach(element => {\n        element.addEventListener('click', closeDropdown);\n        element.addEventListener('mouseover', handleMouseLeave);\n    });\n\n    // Close when clicking anywhere outside\n    document.addEventListener('click', (e) => {\n        if (isOpen && !dropdown.contains(e.target)) {\n            closeDropdown();\n        }\n    });\n\n    // Handle keyboard navigation\n    document.addEventListener('keydown', (e) => {\n        if (e.key === 'Escape' && isOpen) {\n            closeDropdown();\n        }\n    });\n}\n\nclass InfiniteCarousel {\n    constructor(containerId = 'carousel-container') {\n        this.container = document.getElementById(containerId);\n        if (!this.container) return;\n        this.track = this.container.querySelector('.carousel-track');\n        if (!this.track) return;\n\n        this.scrollPosition = 0;\n        this.isHovered = false;\n        this.animationFrame = null;\n        this.init();\n    }\n\n    init() {\n        this.setupCarousel();\n        this.addEventListeners();\n        setTimeout(() => {\n            this.track.classList.add('loaded');\n            this.startAnimation();\n        }, 100);\n    }\n\n    setupCarousel() {\n        const originalCards = Array.from(this.track.querySelectorAll('.article-card'));\n        if (!originalCards.length) return;\n\n        // Add performance optimizations\n        this.track.style.willChange = 'transform';\n        this.track.style.backfaceVisibility = 'hidden';\n        this.track.style.transform = 'translate3d(0, 0, 0)';\n\n        const cardWidth = originalCards[0].offsetWidth;\n        const gapWidth = 24;\n        const setWidth = originalCards.length * (cardWidth + gapWidth);\n\n        // Clone sets for more buffer\n        for (let i = 0; i < 4; i++) {\n            const cloneSet = originalCards.map(card => card.cloneNode(true));\n            cloneSet.forEach(card => this.track.appendChild(card));\n        }\n\n        this.totalWidth = setWidth;\n        this.resetPoint = -(setWidth * 3);\n    }\n\n    startAnimation() {\n        let lastTime = performance.now();\n\n        const animate = (currentTime) => {\n            const deltaTime = (currentTime - lastTime) / 16; // Normalize to ~60fps\n            lastTime = currentTime;\n\n            const speed = this.isHovered ? 0.5 : 1.3;\n            this.scrollPosition -= speed * deltaTime;\n\n            if (this.scrollPosition <= this.resetPoint) {\n                this.scrollPosition += this.totalWidth;\n            }\n\n            this.track.style.transform = `translate3d(${this.scrollPosition}px, 0, 0)`;\n            this.animationFrame = requestAnimationFrame(animate);\n        };\n\n        animate(performance.now());\n    }\n\n    addEventListeners() {\n        // Mouse events\n        this.track.addEventListener('mouseenter', () => {\n            this.isHovered = true;\n        });\n\n        this.track.addEventListener('mouseleave', () => {\n            this.isHovered = false;\n        });\n\n        // Touch events for mobile\n        if ('ontouchstart' in window) {\n            this.track.addEventListener('touchstart', () => {\n                this.isHovered = true;\n            });\n\n            this.track.addEventListener('touchend', () => {\n                this.isHovered = false;\n            });\n        }\n\n        // Window resize handling\n        window.addEventListener('resize', () => {\n            cancelAnimationFrame(this.animationFrame);\n            this.setupCarousel();\n            this.startAnimation();\n        });\n\n        // Visibility change handling\n        document.addEventListener('visibilitychange', () => {\n            if (document.hidden) {\n                cancelAnimationFrame(this.animationFrame);\n            } else {\n                this.startAnimation();\n            }\n        });\n    }\n}\n\nfunction initHeaderScroll() {\n    const header = document.querySelector('.site-header');\n    if (!header) return;\n\n    const SCROLL_THRESHOLD = 10;\n    let ticking = false;\n\n    function updateHeader() {\n        const scrolled = window.scrollY > SCROLL_THRESHOLD;\n        header.classList.toggle('scrolled', scrolled);\n        ticking = false;\n    }\n\n    function onScroll() {\n        if (!ticking) {\n            requestAnimationFrame(() => {\n                updateHeader();\n            });\n            ticking = true;\n        }\n    }\n\n    window.addEventListener('scroll', onScroll, { passive: true });\n    updateHeader();\n}\n\ndocument.addEventListener('DOMContentLoaded', () => {\n    initSkipLink();\n    initGlobalHandlers();\n    window.__articleNavigation = initArticleNavigation();\n    initOffCanvas();\n    initImageLoading();\n    initComments();\n    initPriceToggle();\n    initGridLayout();\n    initSidenotes();\n    initTestimonials();\n    initWeatherDisplay();\n    initKnicksCounter();\n    initRelatedArticlesPanel();\n    initRelatedArticleInteractions();\n    initTagScroll();\n    initHeaderDropdown();\n    new InfiniteCarousel();\n    initHeaderScroll();\n\n    // Initialize native share functionality\n    const nativeShareButtons = document.querySelectorAll('.native-share');\n    const shareSeparators = document.querySelectorAll('.share-separator');\n\n    if (navigator.share) {  // Changed from canShare to share\n        // Show both the button and separator\n        nativeShareButtons.forEach(btn => btn.style.display = 'block');\n        shareSeparators.forEach(sep => sep.style.display = 'block');\n\n        nativeShareButtons.forEach(btn => {\n            btn.addEventListener('click', async (e) => {\n                e.preventDefault();\n\n                if (!RateLimiter.checkLimit('shareAction', 10)) {\n                    console.warn('Too many share attempts');\n                    return;\n                }\n\n                const article = e.target.closest('article');\n                if (!article) return;\n\n                const articleLink = article.querySelector('h2 a');\n                const url = articleLink ? articleLink.href : window.location.href;\n                const rawTitle = articleLink ? articleLink.textContent : document.title;\n                const sanitizedTitle = sanitizeText(rawTitle);\n\n                if (!isValidUrl(url)) {\n                    console.error('Invalid URL detected');\n                    return;\n                }\n\n                try {\n                    await navigator.share({\n                        title: sanitizedTitle,\n                        text: sanitizedTitle,  // Added text field for better compatibility\n                        url: url\n                    });\n                } catch (err) {\n                    if (err.name !== 'AbortError') {  // Ignore user cancellations\n                        console.error('Share failed:', err);\n                    }\n                }\n            });\n        });\n    }\n});\n\n////////// Skip Link //////////\nfunction initSkipLink() {\n    const skipLink = document.querySelector('.skip-link');\n    if (skipLink) {\n        skipLink.addEventListener('click', (e) => {\n            e.preventDefault();\n            const main = document.querySelector('main');\n            if (main) {\n                main.setAttribute('tabindex', '-1');\n                main.focus();\n                main.scrollIntoView();\n            }\n        });\n    }\n}\n\n////////// Article Navigation //////////\nfunction initArticleNavigation() {\n    let articles = document.querySelectorAll('article');\n    if (!articles.length) return;\n\n    let currentArticleIndex = 0;\n\n    // Add navigation hints for screen readers\n    const navHint = document.createElement('div');\n    navHint.className = 'visually-hidden';\n    navHint.setAttribute('role', 'status');\n    navHint.textContent = 'Use J and K keys to navigate between articles';\n    document.body.appendChild(navHint);\n\n    function updateArticleIndices() {\n        articles = document.querySelectorAll('article'); // Get fresh list\n        articles.forEach((article, index) => {\n            article.setAttribute('tabindex', '-1');\n            article.setAttribute('data-article-index', index.toString());\n        });\n    }\n\n    // Initial setup\n    updateArticleIndices();\n\n    // Handle keyboard navigation\n    function handleKeyNavigation(e) {\n        if (e.target.matches('input, textarea')) return;\n\n        let nextIndex = currentArticleIndex;\n\n        switch(e.key.toLowerCase()) {\n            case 'j':\n                e.preventDefault();\n                nextIndex = Math.min(currentArticleIndex + 1, articles.length - 1);\n                break;\n            case 'k':\n                e.preventDefault();\n                nextIndex = Math.max(currentArticleIndex - 1, 0);\n                break;\n        }\n\n        if (nextIndex !== currentArticleIndex) {\n            const nextArticle = articles[nextIndex];\n            currentArticleIndex = nextIndex;\n\n            nextArticle.scrollIntoView({ behavior: 'smooth', block: 'start' });\n            nextArticle.focus();\n\n            const title = nextArticle.querySelector('h2')?.textContent || 'Article';\n            const position = `${nextIndex + 1} of ${articles.length}`;\n\n            const announcement = document.createElement('div');\n            announcement.setAttribute('role', 'status');\n            announcement.setAttribute('aria-live', 'polite');\n            announcement.className = 'visually-hidden';\n            announcement.textContent = `${title}. Article ${position}`;\n            document.body.appendChild(announcement);\n            setTimeout(() => announcement.remove(), 1000);\n        }\n    }\n\n    document.addEventListener('keydown', handleKeyNavigation);\n\n    // Add visual focus styles\n    const style = document.createElement('style');\n    style.textContent = `\n        article:focus {\n            outline: 2px solid #007bff;\n            outline-offset: 8px;\n        }\n        article:focus:not(:focus-visible) {\n            outline: none;\n        }\n    `;\n    document.head.appendChild(style);\n\n    // Return the update function so we can call it when new articles are loaded\n    return updateArticleIndices;\n}\n\n////////// Global Event Handlers //////////\nfunction initGlobalHandlers() {\n    document.addEventListener('click', (e) => {\n        if (!RateLimiter.checkLimit('globalClicks', 100, 60000)) {\n            console.warn('Too many clicks detected');\n            return;\n        }\n\n        // Handle clipboard clicks\n       if (e.target.closest('.copy-url')) {\n           e.preventDefault();\n           handleClipboardClick(e);  // This calls your working clipboard function\n       }\n\n        // Handle email shares\n       if (e.target.closest('.email-share')) {\n           e.preventDefault();\n           handleEmailShare(e);  // This calls your working email function\n       }\n\n        // Handle native share\n        if (e.target.closest('.native-share')) {\n            e.preventDefault();\n            const article = e.target.closest('article');\n            if (!article) return;\n\n            const articleLink = article.querySelector('h2 a');\n            const url = articleLink ? articleLink.href : window.location.href;\n            const rawTitle = articleLink ? articleLink.textContent : document.title;\n            const sanitizedTitle = sanitizeText(rawTitle);\n\n            const shareData = {\n                title: sanitizedTitle,\n                text: sanitizedTitle,\n                url: url\n            };\n\n            // First check if we can share this specific data\n            if (navigator.canShare && navigator.canShare(shareData)) {\n                navigator.share(shareData)\n                    .then(() => console.log('Shared successfully'))\n                    .catch((err) => {\n                        if (err.name !== 'AbortError') {\n                            console.error('Share failed:', err);\n                        }\n                    });\n            } else if (navigator.share) {\n                // Fallback to just checking share API availability\n                navigator.share(shareData)\n                    .then(() => console.log('Shared successfully'))\n                    .catch((err) => {\n                        if (err.name !== 'AbortError') {\n                            console.error('Share failed:', err);\n                        }\n                    });\n            } else {\n                console.log('Web Share API not supported');\n            }\n        }\n\n        // Handle WhatsApp shares\n        if (e.target.closest('.whatsapp-share')) {\n            e.preventDefault();\n            const article = e.target.closest('article');\n            if (!article) return;\n\n            const articleLink = article.querySelector('h2 a');\n            const url = articleLink ? articleLink.href : window.location.href;\n            const rawTitle = articleLink ? articleLink.textContent : document.title;\n            const sanitizedTitle = sanitizeText(rawTitle);\n\n            if (!isValidUrl(url)) {\n                console.error('Invalid URL detected');\n                return;\n            }\n\n            window.open(getWhatsAppShareUrl(url, sanitizedTitle), '_blank', 'noopener,noreferrer');\n        }\n\n    // Handle Mastodon shares\n    if (e.target.closest('.mastodon-share')) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        if (!RateLimiter.checkLimit('mastodonShare', 10)) {\n            console.warn('Too many share attempts');\n            return;\n        }\n\n        const article = e.target.closest('article');\n        if (!article) return;\n\n        const articleLink = article.querySelector('h2 a');\n        const url = articleLink ? articleLink.href : window.location.href;\n        const rawTitle = articleLink ? articleLink.textContent : document.title;\n        const sanitizedTitle = sanitizeText(rawTitle);\n\n        let instance = window.prompt('Enter your Mastodon instance URL:', localStorage.getItem('mastodon-instance') || 'mastodon.social');\n\n        if (instance) {\n            const cleanInstance = instance\n                .replace(/^https?:\\/\\//, '')\n                .replace(/\\/$/, '')\n                .replace(/[<>'\"`{}()\\[\\]]/g, '');\n            const shareText = `${sanitizedTitle}\\n\\n${url}`;\n            const shareUrl = `https://${cleanInstance}/share?text=${encodeURIComponent(shareText)}`;\n            window.open(shareUrl, '_blank', 'noopener,noreferrer');\n            localStorage.setItem('mastodon-instance', cleanInstance);\n        }\n    }\n\n        // Handle dropdowns\n        const dropdownBtn = e.target.closest('.dropdown-btn');\n        if (dropdownBtn && dropdownBtn.parentElement) {\n            const dropdown = dropdownBtn.nextElementSibling;\n            if (dropdown && dropdown.classList.contains('dropdown-menu')) {\n                const isExpanded = dropdown.classList.contains('active');\n                dropdown.classList.toggle('active');\n                dropdownBtn.setAttribute(ARIA_ATTRS.EXPANDED, (!isExpanded).toString());\n                dropdown.setAttribute(ARIA_ATTRS.HIDDEN, isExpanded.toString());\n            }\n        }\n    });\n\n    // Add keyboard handler for interactive elements\n    document.addEventListener('keydown', (e) => {\n        // Handle dropdown keyboard interactions\n        const dropdownBtn = e.target.closest('.dropdown-btn');\n        if (dropdownBtn) {\n            const dropdown = dropdownBtn.nextElementSibling;\n\n            switch (e.key) {\n                case KEYS.ENTER:\n                case KEYS.SPACE:\n                    e.preventDefault();\n                    dropdownBtn.click();\n                    break;\n                case KEYS.ESCAPE:\n                    if (dropdown?.classList.contains('active')) {\n                        e.preventDefault();\n                        dropdownBtn.click();\n                        dropdownBtn.focus();\n                    }\n                    break;\n            }\n        }\n\n        // Handle general Escape key for any open menus\n        if (e.key === KEYS.ESCAPE) {\n            const openDropdowns = document.querySelectorAll('.dropdown-menu.active');\n            openDropdowns.forEach(dropdown => {\n                const btn = dropdown.previousElementSibling;\n                dropdown.classList.remove('active');\n                dropdown.setAttribute(ARIA_ATTRS.HIDDEN, 'true');\n                if (btn) {\n                    btn.setAttribute(ARIA_ATTRS.EXPANDED, 'false');\n                    btn.focus();\n                }\n            });\n        }\n    });\n}\n\n////////// Price Toggle //////////\nfunction initPriceToggle() {\n    const toggle = document.querySelector('.toggle');\n    if (!toggle) return;\n\n    const toggleButtons = document.querySelectorAll('.toggle button');\n    const yearlyElements = document.querySelectorAll('[data-yearly]');\n    const monthlyElements = document.querySelectorAll('[data-monthly]');\n\n    toggleButtons.forEach(button => {\n        // Add ARIA attributes\n        button.setAttribute('role', 'switch');\n        button.setAttribute(ARIA_ATTRS.CHECKED, 'false');\n\n        button.addEventListener('click', () => {\n            const priceType = button.getAttribute('data-price');\n            if (!['yearly', 'monthly'].includes(priceType)) return;\n\n            // Update ARIA states\n            toggleButtons.forEach(btn => {\n                btn.classList.remove('active');\n                btn.setAttribute(ARIA_ATTRS.CHECKED, 'false');\n            });\n            button.classList.add('active');\n            button.setAttribute(ARIA_ATTRS.CHECKED, 'true');\n\n            toggle.setAttribute('data-active-price', priceType);\n\n            const isYearly = priceType === 'yearly';\n            yearlyElements.forEach(el => {\n                el.style.display = isYearly ? 'block' : 'none';\n                el.setAttribute(ARIA_ATTRS.HIDDEN, (!isYearly).toString());\n            });\n            monthlyElements.forEach(el => {\n                el.style.display = isYearly ? 'none' : 'block';\n                el.setAttribute(ARIA_ATTRS.HIDDEN, isYearly.toString());\n            });\n        });\n\n        // Add keyboard support\n        button.addEventListener('keydown', (e) => {\n            if (e.key === KEYS.ENTER || e.key === KEYS.SPACE) {\n                e.preventDefault();\n                button.click();\n            }\n        });\n    });\n}\n\n////////// Add to Clipboard Functionality //////////\nasync function handleClipboardClick(e) {\n    e.preventDefault();\n\n    if (!RateLimiter.checkLimit('clipboardCopy', 10)) {\n        console.warn('Too many clipboard attempts');\n        return;\n    }\n\n    const article = e.target.closest('article');\n    if (!article) return;\n\n    const articleLink = article.querySelector('h2 a');\n    const url = articleLink ? articleLink.href : window.location.href;\n\n    try {\n        await navigator.clipboard.writeText(url);\n        const target = e.target.closest('.copy-url');\n        showCopyAlert(target, true);\n    } catch (err) {\n        console.error('Failed to copy URL:', err);\n        showCopyAlert(e.target, false);\n    }\n}\n\n// Function to show the copy confirmation\nfunction showCopyAlert(target, success = true) {\n    const dropdownMenu = target.closest('.dropdown');\n    if (!dropdownMenu) return;\n\n    const rect = dropdownMenu.getBoundingClientRect();\n    const alertBox = document.createElement('div');\n    alertBox.className = 'copy-alert';\n    alertBox.setAttribute('role', 'alert');\n    alertBox.setAttribute('aria-live', 'polite');\n\n    Object.assign(alertBox.style, {\n        position: 'fixed',\n        left: `${rect.left + (rect.width / 2)}px`,\n        bottom: `${window.innerHeight - rect.top + 10}px`,\n        backgroundColor: success ? '#333' : '#dc3545',\n        color: 'white',\n        padding: '12px 24px',\n        borderRadius: '4px',\n        zIndex: '1000',\n        fontSize: '14px',\n        fontFamily: 'var(--sans-serif)',\n        opacity: '0',\n        transition: 'opacity 0.3s ease-in-out',\n        whiteSpace: 'nowrap',\n        transform: 'translateX(-50%)'\n    });\n\n    alertBox.textContent = success ? 'URL copied to clipboard' : 'Failed to copy URL';\n    document.body.appendChild(alertBox);\n\n    requestAnimationFrame(() => {\n        alertBox.style.opacity = '1';\n        setTimeout(() => {\n            alertBox.style.opacity = '0';\n            setTimeout(() => alertBox.remove(), 300);\n        }, 2000);\n    });\n}\n\n////////// Social Share Handlers //////////\nfunction getWhatsAppShareUrl(url, title) {\n    const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);\n    const whatsappBase = isMobile ? 'whatsapp://send' : 'https://web.whatsapp.com/send';\n    const shareText = `${title}\\n\\n${url}`;\n    return `${whatsappBase}?text=${encodeURIComponent(shareText)}`;\n}\n\n////////// Slideover Menu //////////\nfunction initOffCanvas() {\n    const html = document.documentElement;\n    const burger = document.querySelector('.burger');\n    const canvasClose = document.querySelector('.canvas-close');\n    const dimmer = document.querySelector('.dimmer');\n    const offCanvas = document.querySelector('.off-canvas');\n\n    if (!burger || !canvasClose || !dimmer || !offCanvas) return;\n\n    // Initialize ARIA attributes\n    burger.setAttribute(ARIA_ATTRS.EXPANDED, 'false');\n    burger.setAttribute(ARIA_ATTRS.CONTROLS, 'off-canvas-menu');\n    offCanvas.setAttribute('id', 'off-canvas-menu');\n    offCanvas.setAttribute(ARIA_ATTRS.HIDDEN, 'true');\n    offCanvas.setAttribute('role', 'dialog');\n    offCanvas.setAttribute(ARIA_ATTRS.LABEL, 'Side Menu');\n\n    let lastFocusedElement;\n    let removeFocusTrap;\n\n    function toggleDimmer(action) {\n        if (!['open', 'close'].includes(action)) return;\n        dimmer.style.display = action === 'open' ? 'block' : 'none';\n        dimmer.style.opacity = action === 'open' ? '1' : '0';\n        dimmer.setAttribute(ARIA_ATTRS.HIDDEN, action === 'close' ? 'true' : 'false');\n    }\n\n    function openCanvas() {\n        lastFocusedElement = document.activeElement;\n        html.classList.add('canvas-opened', 'canvas-visible');\n        burger.setAttribute(ARIA_ATTRS.EXPANDED, 'true');\n        offCanvas.setAttribute(ARIA_ATTRS.HIDDEN, 'false');\n        toggleDimmer('open');\n\n        // Focus first focusable element in off-canvas\n        const firstFocusable = offCanvas.querySelector('a[href], button:not([disabled])');\n        firstFocusable?.focus();\n\n        // Set up focus trap\n        removeFocusTrap = trapFocus(offCanvas);\n    }\n\n    function closeCanvas() {\n        html.classList.remove('canvas-opened');\n        burger.setAttribute(ARIA_ATTRS.EXPANDED, 'false');\n        offCanvas.setAttribute(ARIA_ATTRS.HIDDEN, 'true');\n        toggleDimmer('close');\n\n        // Remove focus trap\n        if (removeFocusTrap) {\n            removeFocusTrap();\n        }\n\n        // Return focus\n        if (lastFocusedElement) {\n            lastFocusedElement.focus();\n        }\n    }\n\n    burger.addEventListener('click', openCanvas);\n    canvasClose.addEventListener('click', closeCanvas);\n    dimmer.addEventListener('click', closeCanvas);\n\n    document.addEventListener('keydown', (e) => {\n        if (e.key === KEYS.ESCAPE && html.classList.contains('canvas-opened')) {\n            closeCanvas();\n        }\n    });\n}\n\n////////// Images //////////\nfunction initImageLoading() {\n    let observer;\n\n    const handleAboveFoldImages = () => {\n        if (observer) {\n            observer.disconnect();\n        }\n\n        const viewportHeight = window.innerHeight;\n        const buffer = 100;\n\n        observer = new IntersectionObserver((entries) => {\n            entries.forEach(entry => {\n                if (entry.isIntersecting &&\n                    entry.boundingClientRect.top < (viewportHeight + buffer) &&\n                    entry.target instanceof HTMLImageElement) {\n                    const img = entry.target;\n                    // Ensure alt text is present\n                    if (!img.hasAttribute('alt')) {\n                        img.setAttribute('alt', '');\n                    }\n                    img.removeAttribute('loading');\n                    observer.unobserve(img);\n                }\n            });\n        });\n\n        document.querySelectorAll('img[loading=\"lazy\"]').forEach(img => {\n            if (img instanceof HTMLImageElement) {\n                observer.observe(img);\n            }\n        });\n    };\n\n    handleAboveFoldImages();\n    window.addEventListener('resize', debounce(handleAboveFoldImages, 250));\n}\n\n////////// Comment Box Show/Hide //////////\nfunction initComments() {\n    const showCommentsBtn = document.getElementById('showCommentsBtn');\n    const commentBlock = document.getElementById('commentBlock');\n    if (!showCommentsBtn || !commentBlock) return;\n\n    // Initialize ARIA attributes\n    showCommentsBtn.setAttribute(ARIA_ATTRS.EXPANDED, 'false');\n    showCommentsBtn.setAttribute(ARIA_ATTRS.CONTROLS, 'commentBlock');\n    commentBlock.setAttribute(ARIA_ATTRS.HIDDEN, 'true');\n\n    showCommentsBtn.addEventListener('click', () => {\n        const isVisible = commentBlock.style.display !== 'none';\n        commentBlock.style.display = isVisible ? 'none' : 'block';\n        showCommentsBtn.setAttribute(ARIA_ATTRS.EXPANDED, (!isVisible).toString());\n        commentBlock.setAttribute(ARIA_ATTRS.HIDDEN, isVisible.toString());\n\n        // Announce state change to screen readers\n        const announcement = document.createElement('div');\n        announcement.setAttribute('role', 'status');\n        announcement.setAttribute('aria-live', 'polite');\n        announcement.className = 'visually-hidden';\n        announcement.textContent = `Comments are now ${isVisible ? 'hidden' : 'visible'}`;\n        document.body.appendChild(announcement);\n        setTimeout(() => announcement.remove(), 1000);\n    });\n\n    // Add keyboard support\n    showCommentsBtn.addEventListener('keydown', (e) => {\n        if (e.key === KEYS.ENTER || e.key === KEYS.SPACE) {\n            e.preventDefault();\n            showCommentsBtn.click();\n        }\n    });\n}\n\n////////// Share via Email //////////\nfunction handleEmailShare(e) {\n    e.preventDefault();\n\n    if (!RateLimiter.checkLimit('emailShare', 10)) {\n        console.warn('Too many email share attempts');\n        return;\n    }\n\n    const article = e.target.closest('article');\n    if (!article) return;\n\n    const articleLink = article.querySelector('h2 a');\n    const url = articleLink ? articleLink.href : window.location.href;\n    const rawTitle = articleLink ? articleLink.textContent : document.title;\n    const sanitizedTitle = sanitizeText(rawTitle);\n\n    const emailSubject = `Check out this article: ${sanitizedTitle}`;\n    const emailBody = `I thought you might enjoy this article:\\n\\n${sanitizedTitle}\\n\\n${url}`;\n    const mailtoUrl = `mailto:?subject=${encodeURIComponent(emailSubject)}&body=${encodeURIComponent(emailBody)}`;\n\n    // Create and click a temporary link\n    const tempLink = document.createElement('a');\n    tempLink.href = mailtoUrl;\n    tempLink.style.display = 'none';\n    document.body.appendChild(tempLink);\n    tempLink.click();\n    document.body.removeChild(tempLink);\n}\n\n////////// Masonry Layout and Infinite Load More Posts //////////\n/**\n * Initializes the masonry grid layout and post filtering\n * - Sets up Isotope for masonry layout\n * - Initializes post filtering system\n * - Adds proper ARIA attributes for accessibility\n * - Prepares posts for filtering by adding class names\n */\n\nfunction initGridLayout() {\n     const articleList = document.querySelector('.article-list');\n     if (!articleList) return;\n\n     articleList.setAttribute('role', 'feed');\n     articleList.setAttribute('aria-label', 'Article list');\n\n     const iso = new Isotope(articleList, {\n         itemSelector: '.post',\n         percentPosition: true,\n         layoutMode: 'masonry',\n         masonry: {\n             columnWidth: '.grid-sizer',\n             fitWidth: true,\n             gutter: 30\n         }\n     });\n\n     // Initialize posts with proper filter classes\n     const posts = articleList.querySelectorAll('.post');\n     posts.forEach(post => {\n         const primaryTag = post.querySelector('.primary-tag');\n         if (primaryTag) {\n             const tagClass = sanitizeText(primaryTag.textContent)\n                 .trim()\n                 .toLowerCase()\n                 .replace(/[^a-z0-9-]/g, '-');\n             post.classList.add(tagClass);\n         }\n\n         const img = post.querySelector('img');\n         if (img) {\n             img.addEventListener('load', () => {\n                 iso.layout();\n             });\n         }\n     });\n\n     const handleFilterSelect = initPostFilter(iso);\n\n     window.__components = {\n         infiniteLoader: new InfiniteLoader(iso, handleFilterSelect)\n     };\n\n     iso.layout();\n }\n\n/**\n * Handles infinite scroll functionality for posts\n * Features:\n * - Lazy loads posts as user scrolls\n * - Maintains filter state\n * - Handles errors and retries\n * - Supports both desktop and mobile\n * - Includes accessibility announcements\n */\n\nclass InfiniteLoader {\n    constructor(iso, handleFilterSelect) {\n        this._iso = iso;\n        this._handleFilterSelect = handleFilterSelect;\n        this._nextDom = document;\n        this._loader = document.getElementById('read-more-trigger');\n        this._postList = document.querySelector('.article-list');\n        this._loadingFlag = false;\n        this._currentFilter = 'all';\n        this._loadedPages = 1;\n        this._maxRetries = 3;\n        this._retryDelay = 1000; // 1 second\n        this._isLocalhost = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';\n        this._updateArticleNavigation = null;\n        this._cachedPosts = new Map(); // Cache for loaded posts\n        this._hasMoreFilteredPosts = true;\n        this._initializeAccessibility();\n        this._subscribeToLoadMore();\n    }\n\n    _initializeAccessibility() {\n        if (this._loader) {\n            this._loader.setAttribute('role', 'button');\n            this._loader.setAttribute('aria-label', 'Load more posts');\n            if (!this._loader.hasAttribute('tabindex')) {\n                this._loader.setAttribute('tabindex', '0');\n            }\n        }\n        this._updateArticleNavigation = window.__articleNavigation;\n    }\n\n    _subscribeToLoadMore() {\n        if (!this._loader) return;\n\n        const loadMoreHandler = async () => {\n            if (this._loadingFlag) return;\n\n            this._loadingFlag = true;\n            this._updateLoaderState(true);\n\n            try {\n                const selectedType = localStorage.getItem('selectedPostType') || 'all';\n                const newPosts = await this.loadNextPage();\n\n                if (newPosts && newPosts.length > 0) {\n                    await this._processNewPosts(newPosts, selectedType);\n                } else {\n                    this._showNoMorePosts();\n                }\n\n            } catch (error) {\n                console.error('Error loading more posts:', error);\n                this._announceError();\n\n                // Special handling for localhost\n                if (this._isLocalhost) {\n                    console.log('Retrying in development mode...');\n                    setTimeout(() => {\n                        this._loadingFlag = false;\n                        loadMoreHandler();\n                    }, this._retryDelay);\n                }\n            } finally {\n                if (!this._loader.classList.contains('disabled')) {\n                    this._updateLoaderState(false);\n                }\n            }\n        };\n\n        // Add event listeners\n        this._loader.addEventListener('click', loadMoreHandler);\n        this._loader.addEventListener('keydown', (e) => {\n            if (e.key === 'Enter' || e.key === ' ') {\n                e.preventDefault();\n                loadMoreHandler();\n            }\n        });\n    }\n\n    async loadNextPage(retryCount = 0) {\n        const next = this._nextDom.querySelector('link[rel=\"next\"]');\n        const currentFilter = localStorage.getItem('selectedPostType') || 'all';\n\n        if (!next?.href || (this._loadedPages > 1 && currentFilter !== 'all' && !this._hasMoreFilteredPosts)) {\n            this._showNoMorePosts();\n            return null;\n        }\n\n        try {\n            // Add cache busting for localhost\n            const url = new URL(next.href);\n            if (this._isLocalhost) {\n                url.searchParams.set('t', Date.now());\n            }\n\n            const response = await fetch(url.toString(), {\n                credentials: 'same-origin',\n                headers: {\n                    'X-Requested-With': 'XMLHttpRequest'\n                },\n                // Add cache control for development\n                cache: this._isLocalhost ? 'no-store' : 'default'\n            });\n\n            if (!response.ok) {\n                throw new Error(`HTTP error! status: ${response.status}`);\n            }\n\n            const text = await response.text();\n            const parser = new DOMParser();\n            const doc = parser.parseFromString(text, 'text/html');\n\n            const posts = doc.querySelectorAll('.post');\n            if (!posts.length) {\n                this._showNoMorePosts();\n                return null;\n            }\n\n            this._nextDom = doc;\n            this._loadedPages++;\n\n            return Array.from(posts);\n\n        } catch (error) {\n            console.error('Error in loadNextPage:', error);\n\n            if (retryCount < this._maxRetries) {\n                console.log(`Retrying... Attempt ${retryCount + 1} of ${this._maxRetries}`);\n                await new Promise(resolve =>\n                    setTimeout(resolve, this._retryDelay * (retryCount + 1))\n                );\n                return this.loadNextPage(retryCount + 1);\n            }\n\n            throw error;\n        }\n    }\n\n    async _processNewPosts(newPosts, currentFilter) {\n        if (!newPosts || newPosts.length === 0) {\n            this._showNoMorePosts();\n            return;\n        }\n\n        // Check if we have any posts for the current filter\n        if (currentFilter !== 'all') {\n            const filteredNewPosts = newPosts.filter(post => {\n                const primaryTag = post.querySelector('.primary-tag');\n                return primaryTag && this._sanitizeTagName(primaryTag.textContent) === currentFilter;\n            });\n\n            if (filteredNewPosts.length === 0) {\n                this._showNoMorePosts();\n                return;\n            }\n        }\n\n        // Add posts to DOM and process them\n        const processedPosts = newPosts.map(post => {\n            const processedPost = this._processPost(post);\n            this._postList.appendChild(processedPost);\n            return processedPost;\n        });\n\n        // Update Isotope\n        this._iso.appended(processedPosts);\n\n        // Apply current filter if not showing all posts\n        if (currentFilter !== 'all') {\n            this._iso.arrange({ filter: `.${currentFilter}` });\n\n            // Check if we found any posts for current filter\n            const filteredPosts = processedPosts.filter(post => post.classList.contains(currentFilter));\n            if (filteredPosts.length === 0) {\n                this._hasMoreFilteredPosts = false;\n                this._showNoMorePosts();\n                return;\n            }\n        }\n\n        // Update layout and navigation\n        this._iso.layout();\n        if (this._updateArticleNavigation) {\n            this._updateArticleNavigation();\n        }\n\n        // Cache the processed posts\n        this._cachedPosts.set(this._loadedPages, processedPosts);\n\n        // Announce new content\n        this._announceNewContent(processedPosts.length);\n    }\n\n    _processPost(post) {\n        const primaryTag = post.querySelector('.primary-tag');\n        if (primaryTag) {\n            const tagClass = this._sanitizeTagName(primaryTag.textContent);\n            post.classList.add(tagClass);\n        }\n        return post;\n    }\n\n    _updateLoaderState(isLoading) {\n        if (!this._loader) return;\n\n        this._loadingFlag = isLoading;\n        this._loader.classList.toggle('loading', isLoading);\n        this._loader.textContent = isLoading ? 'Loading...' : 'Load More';\n        this._loader.setAttribute(\n            'aria-label',\n            isLoading ? 'Loading more posts, please wait' : 'Load more posts'\n        );\n    }\n\n    _showNoMorePosts() {\n        if (this._loader) {\n            this._loader.textContent = 'No more posts';\n            this._loader.classList.add('disabled');\n            this._loader.setAttribute('aria-disabled', 'true');\n            this._loader.style.cursor = 'default';\n            // Announce to screen readers\n            this._announceNewContent('No more posts available');\n        }\n    }\n\n    _announceNewContent(message) {\n        const announcement = document.createElement('div');\n        announcement.setAttribute('role', 'status');\n        announcement.setAttribute('aria-live', 'polite');\n        announcement.className = 'visually-hidden';\n        announcement.textContent = typeof message === 'number' ?\n            `${message} new posts loaded` : message;\n        document.body.appendChild(announcement);\n        setTimeout(() => announcement.remove(), 1000);\n    }\n\n    _announceError() {\n        const errorAnnouncement = document.createElement('div');\n        errorAnnouncement.setAttribute('role', 'alert');\n        errorAnnouncement.className = 'visually-hidden';\n        errorAnnouncement.textContent = 'Error loading more posts. Retrying...';\n        document.body.appendChild(errorAnnouncement);\n        setTimeout(() => errorAnnouncement.remove(), 1000);\n    }\n\n    _sanitizeTagName(tagName) {\n        return tagName\n            .trim()\n            .toLowerCase()\n            .replace(/[^a-z0-9-]/g, '-');\n    }\n}\n"],"names":["RateLimiter","getKey","action","Math","floor","Date","now","increment","limit","key","this","count","parseInt","sessionStorage","getItem","setItem","toString","checkLimit","arguments","length","undefined","cleanup","i","startsWith","split","removeItem","SECURITY","urlPatterns","dangerous","symbols","inputPatterns","text","email","numeric","KEYS","TAB","ENTER","ESCAPE","SPACE","UP","DOWN","LEFT","RIGHT","HOME","END","J","K","N","P","ARIA_ATTRS","EXPANDED","HIDDEN","CONTROLS","CHECKED","SELECTED","LABEL","LABELLEDBY","LISTBOX","OPTION","SIDENOTES_CONFIG","FILTER_CONFIG","containerId","types","id","label","RELATED_PANEL_CONFIG","triggerButtonClass","panelClass","overlayClass","closeBtnClass","activeClass","panelOpenClass","maxOpenAttempts","timeWindowMs","focusableSelectors","join","TESTIMONIALS_CONFIG","updateInterval","fadeTransitionMs","testimonials","quote","author","avatar","link","WEATHER_ICONS","sunny","cloudy","rainy","drizzle","snow","foggy","sanitizeHTML","html","div","document","createElement","textContent","innerHTML","replace","isValidUrl","url","urlObj","URL","decodedUrl","decodeURIComponent","hasValidExtension","some","ext","pathname","toLowerCase","endsWith","origin","window","location","protocol","username","password","test","debounce","func","wait","timeout","immediate","_len2","args","Array","_key2","callNow","clearTimeout","setTimeout","later","apply","sanitizeText","maxLength","slice","initPostFilter","iso","articleList","querySelector","filter","FILTER_ICONS","all","article","bookmarks","notes","quotes","container","className","button","setAttribute","staticText","dynamicText","buttonIcon","appendChild","dropdown","style","display","ul","forEach","type","li","iconSpan","textSpan","createFilterDropdown","Object","assign","opacity","visibility","transition","height","headerDropdown","checkScrollPosition","scrollTriggerPoint","getBoundingClientRect","top","scrollY","requestAnimationFrame","after","addEventListener","filterButton","filterDropdown","filterOptions","querySelectorAll","buttonText","positionDropdown","buttonRect","position","bottom","left","width","max","toggleDropdown","show","handleFilterSelect","typeId","option","dataset","value","selectedType","find","t","classList","toggle","announcement","body","remove","localStorage","arrange","isExpanded","getAttribute","e","contains","target","focus","tagName","preventDefault","currentOption","activeElement","options","from","currentIndex","indexOf","nextIndex","passive","savedType","initTestimonials","testimonialElement","getElementById","indices","_","shuffleArray","array","j","random","updateTestimonial","content","transform","testimonial","console","log","avatarPath","sanitizedQuote","sanitizedAuthor","sanitizedLink","sanitizedAvatar","replaceAll","createTestimonialHTML","newContent","setInterval","initWeatherDisplay","tempElement","conditionElement","weatherMap","rain","thunderstorm","getOneWordWeather","code","word","codes","entries","includes","async","weatherUpdateInterval","clearInterval","updateWeatherDisplay","weather","lat","lon","searchParams","set","response","fetch","ok","Error","data","json","result","temp","round","current","temperature_2m","condition","weather_code","lastUpdated","toISOString","localTime","toLocaleString","timeZone","JSON","stringify","error","getWeatherData","iconTemplate","tempLi","closest","existingIcon","parentElement","iconContainer","insertBefore","firstChild","updateWeatherIcon","threeHours","hidden","cached","parse","updateDisplay","initHeaderDropdown","overlay","backdrop","isOpen","timeoutId","closeDropdown","handleMouseLeave","handleMouseEnter","stopPropagation","add","element","trustedTypes","createPolicy","createHTML","string","createScriptURL","createScript","InfiniteCarousel","constructor","track","scrollPosition","isHovered","animationFrame","init","setupCarousel","addEventListeners","startAnimation","originalCards","willChange","backfaceVisibility","cardWidth","offsetWidth","setWidth","map","card","cloneNode","totalWidth","resetPoint","lastTime","performance","animate","currentTime","deltaTime","speed","cancelAnimationFrame","showCopyAlert","success","dropdownMenu","rect","alertBox","innerHeight","backgroundColor","color","padding","borderRadius","zIndex","fontSize","fontFamily","whiteSpace","skipLink","main","scrollIntoView","initSkipLink","warn","articleLink","href","navigator","clipboard","writeText","err","handleClipboardClick","sanitizedTitle","title","emailBody","mailtoUrl","encodeURIComponent","tempLink","click","removeChild","handleEmailShare","shareData","canShare","share","then","catch","name","open","isMobile","userAgent","shareText","getWhatsAppShareUrl","instance","prompt","cleanInstance","shareUrl","dropdownBtn","nextElementSibling","btn","previousElementSibling","__articleNavigation","articles","currentArticleIndex","navHint","updateArticleIndices","index","handleKeyNavigation","matches","min","nextArticle","behavior","block","head","initArticleNavigation","documentElement","burger","canvasClose","dimmer","offCanvas","lastFocusedElement","removeFocusTrap","toggleDimmer","openCanvas","firstFocusable","focusableElements","lastFocusable","handleTabKey","shiftKey","removeEventListener","trapFocus","closeCanvas","initOffCanvas","observer","handleAboveFoldImages","disconnect","viewportHeight","buffer","IntersectionObserver","entry","isIntersecting","boundingClientRect","HTMLImageElement","img","hasAttribute","removeAttribute","unobserve","observe","initImageLoading","showCommentsBtn","commentBlock","isVisible","initComments","toggleButtons","yearlyElements","monthlyElements","priceType","isYearly","el","initPriceToggle","Isotope","itemSelector","percentPosition","layoutMode","masonry","columnWidth","fitWidth","gutter","post","primaryTag","tagClass","trim","layout","__components","infiniteLoader","InfiniteLoader","initGridLayout","createSidenote","num","sidenote","positionSidenotes","sidenotes","innerWidth","ref","refRect","contentRect","topPosition","prevRect","minGap","handleResponsiveLayout","desktopNotes","mobileNotes","paragraphs","getElementsByTagName","footnotes","footnoteRegex","referenceRegex","p","match","number","noteContent","keys","sidenoteContainer","mobileSidenoteContainer","_ref","mobileSidenote","footer","note","offsetHeight","initSidenotes","counterElement","calculateDays","championship","diff","daysSince","est","tomorrow","setDate","getDate","setHours","setMidnightUpdate","initKnicksCounter","elements","trigger","CSS","escape","panel","closeBtn","values","every","Boolean","rateLimiter","attempts","lastReset","togglePanelClasses","updateAriaAttributes","String","closePanel","removeEventListeners","Set","addSecureEventListener","event","handler","secureHandler","offsetParent","isFirstElement","isLastElement","initRelatedArticlesPanel","stack","cards","topCard","clickedZIndex","leftBtn","rightBtn","startX","scrollLeft","isMouseDown","handleDragStart","cursor","userSelect","pageX","touches","offsetLeft","handleDragEnd","removeProperty","handleDragMove","walk","checkScroll","scrollWidth","clientWidth","scroll","direction","scrollBy","initTagScroll","header","SCROLL_THRESHOLD","ticking","updateHeader","scrolled","initHeaderScroll","nativeShareButtons","shareSeparators","sep","_iso","_handleFilterSelect","_nextDom","_loader","_postList","_loadingFlag","_currentFilter","_loadedPages","_maxRetries","_retryDelay","_isLocalhost","hostname","_updateArticleNavigation","_cachedPosts","Map","_hasMoreFilteredPosts","_initializeAccessibility","_subscribeToLoadMore","loadMoreHandler","_updateLoaderState","newPosts","loadNextPage","_processNewPosts","_showNoMorePosts","_announceError","retryCount","next","currentFilter","credentials","headers","cache","status","doc","DOMParser","parseFromString","posts","Promise","resolve","_sanitizeTagName","processedPosts","processedPost","_processPost","appended","_announceNewContent","isLoading","message","errorAnnouncement"],"mappings":"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"}